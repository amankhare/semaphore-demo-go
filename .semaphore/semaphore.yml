version: v1.0
name: Semaphore Go CI example
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Build project
    task:
      jobs:
        - name: go get & build
          commands:
            - checkout
            - sem-version go 1.16
            - go get
            - go build -o ./bin/main
            - cache store $(checksum main.go) bin
            - export SEMAPHORE_WORKFLOW_TRIGGERED_BY_ME="Aman"
      prologue:
        commands:
          - echo "Hello ---- IT IS PROLOGUE "
      epilogue:
        always:
          commands:
            - touch abc.txt
            - touch abc2.txt
            - echo "AHAM" > abc.txt
            - echo "AHAM1" > abc2.txt
            - cache store A abc.txt
            - artifact push workflow abc2.txt
            - export SEMAPHORE_WORKFLOW_TRIGGERED_BY_ME2="Aman khare"
        on_pass:
          commands:
            - 'echo "Hello -- If passed,  execute this epilogue"'
        on_fail:
          commands:
            - echo "Hello -- If failed execute this epilogue"
      env_vars:
        - name: SEMAPHORE_WORKFLOW_TRIGGERED_BY_ME1
          value: '"khare"'
    dependencies: []
after_pipeline:
  task:
    jobs:
      - name: 'Job #2'
        commands:
          - cache restore A
          - cat abc.txt
          - ls
          - ls /tmp
          - echo $SEMAPHORE_WORKFLOW_TRIGGERED_BY_ME
          - echo $SEMAPHORE_WORKFLOW_TRIGGERED_BY_ME2
          - echo $SEMAPHORE_WORKFLOW_TRIGGERED_BY_ME3
          - artifact pull workflow abc2.txt
          - ls /tmp
          - ls
          - artifact yank workflow act2.txt
