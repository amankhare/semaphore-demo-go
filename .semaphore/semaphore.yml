version: v1.0
name: Semaphore Go CI example
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Build project
    task:
      jobs:
        - name: go get & build
          commands:
            - checkout
            - sem-version go 1.16
            - go get
            - go build -o ./bin/main
            - cache store $(checksum main.go) bin
      prologue:
        commands:
          - echo "Hello ---- IT IS PROLOGUE "
      epilogue:
        always:
          commands:
            - touch abc.txt
            - echo "AHAM"
            - cache store A abc.txt
        on_pass:
          commands:
            - 'echo "Hello -- If passed,  execute this epilogue"'
        on_fail:
          commands:
            - echo "Hello -- If failed execute this epilogue"
    dependencies: []
after_pipeline:
  task:
    jobs:
      - name: Publish Results
        commands:
          - test-results gen-pipeline-report
      - name: 'Job #2'
        commands:
          - cache restore A
          - cat abc.txt
          - echo "My task is done"
