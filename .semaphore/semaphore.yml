version: v1.0
name: Semaphore Go CI example
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Build project
    task:
      jobs:
        - name: go get & build
          commands:
            - 'touch /home/semaphore/${SEMAPHORE_WORKFLOW_ID}-SCAN-RESULT.txt'
            - 'echo "Aman khare" > ${SEMAPHORE_WORKFLOW_ID}-SCAN-RESULT.txt'
            - 'cache store $SEMAPHORE_WORKFLOW_ID-SCAN-RESULT ${SEMAPHORE_WORKFLOW_ID}-SCAN-RESULT.txt'
      prologue:
        commands:
          - echo "Hello ---- IT IS PROLOGUE "
      epilogue:
        always:
          commands:
            - ls /home/semaphore/
            - cache delete A
            - echo "Hello" > abc.txt
            - cache store A abc.txt
            - cache delete A
        on_pass:
          commands:
            - 'echo "Hello -- If passed,  execute this epilogue"'
        on_fail:
          commands:
            - echo "Hello -- If failed execute this epilogue"
      env_vars:
        - name: SEMAPHORE_WORKFLOW_TRIGGERED_BY_ME1
          value: '"khare"'
    dependencies: []
after_pipeline:
  task:
    jobs:
      - name: 'Job #2'
        commands:
          - cache restore $SEMAPHORE_WORKFLOW_ID-SCAN-RESULT
          - ls -a
          - cache delete $SEMAPHORE_WORKFLOW_ID-SCAN-RESULT
          - cat *SCAN-RESULT.txt
