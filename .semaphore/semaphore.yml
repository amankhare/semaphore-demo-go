version: v1.0
name: Semaphore Go CI example
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Build project
    task:
      jobs:
        - name: go get & build
          commands:
            - cache store $(checksum main.go) bin
            - export SEMAPHORE_WORKFLOW_TRIGGERED_BY_ME="Aman"
            - touch /home/semaphore/abc.txt
            - ls /home/semaphore
            - artifact push workflow /home/semaphore/abc.txt
      prologue:
        commands:
          - echo "Hello ---- IT IS PROLOGUE "
      epilogue:
        always:
          commands:
            - ls /home/semaphore/
            - cache delete A
            - echo "Hello" > abc.txt
            - cache store A abc.txt
            - cache delete A
        on_pass:
          commands:
            - 'echo "Hello -- If passed,  execute this epilogue"'
        on_fail:
          commands:
            - echo "Hello -- If failed execute this epilogue"
      env_vars:
        - name: SEMAPHORE_WORKFLOW_TRIGGERED_BY_ME1
          value: '"khare"'
    dependencies: []
after_pipeline:
  task:
    jobs:
      - name: 'Job #2'
        commands:
          - ls /home/semaphore
          - artifact pull workflo abc.txt
          - pwd
          - ls
          - ls /opt
          - cache restore A
          - 'cache restore A && cache delete A && ! (test -f abc.txt) '
      - name: 'Job #1'
        commands:
          - artifact pull workflow abc.txt
